# üèóÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡∏£‡∏î (Live Trading System) ‚Äî Overview & Stage Guide

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡∏£‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏£‡∏≤‡∏ö‡∏ß‡πà‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£ ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡πÑ‡∏´‡∏ô (Stage) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î‡∏à‡∏£‡∏¥‡∏á

---

## üõ∞Ô∏è 1. ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏° (System Architecture)

‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô **Event-Driven ‡πÅ‡∏ö‡∏ö Asyncio** ‡πÇ‡∏î‡∏¢‡πÅ‡∏ö‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 5 ‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å:

```ascii
[ Binance WS ] ‚îÄ‚îÄ‚îÄ‚îÄ> [ Bar Aggregator ] ‚îÄ‚îÄ‚îÄ‚îÄ> [ Signal Engine ]
      ‚Üë                      ‚îÇ                       ‚îÇ
      ‚îÇ              (Volume Bars)            (Signal Alert)
      ‚îÇ                      ‚îÇ                       ‚Üì
[ User Stream ] <‚îÄ‚îÄ‚îÄ‚îÄ [ Order Monitor ] <‚îÄ‚îÄ‚îÄ‚îÄ [ Live Orchestrator ]
  (Order Update)            (OMS)              (Risk & Execution)
```

1.  **BinanceWSManager**: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Raw Trades ‡πÅ‡∏•‡∏∞ User Data (Balance, Order Update)
2.  **VolumeBarAggregator**: ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡∏£‡∏î‡πÄ‡∏õ‡πá‡∏ô "Volume Bars" (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà Time Bars) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î noise
3.  **SignalEngine (The Brain)**: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Indicator (VWAP, EMA, BB, RSI, ATR) ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á Signal
4.  **LiveTradingSystem (The Heart)**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (Risk), Circuit Breaker ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ó‡∏£‡∏î
5.  **OrderMonitor (OMS)**: ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Order (State Machine) ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏ì‡∏µ Order ‡∏Ñ‡πâ‡∏≤‡∏á (Orphan)

---

## üîÑ 2. ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î (Trading Flow)

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏≤‡∏° Step ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

1.  **Aggregation**: `main.py` ‡∏£‡∏±‡∏ö Trade ‚Üí `VolumeBarAggregator` ‡∏™‡∏∞‡∏™‡∏°‡∏à‡∏ô‡∏Ñ‡∏£‡∏ö Volume ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
2.  **Signal Check**: ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Bar ‡∏Ñ‡∏£‡∏ö ‚Üí ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ `SignalEngine.on_volume_bar()` ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì
3.  **Risk Validation**: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì ‚Üí ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏µ‡πà `main.py`:
    *   **Circuit Breaker**: ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡πÑ‡∏´‡∏°? ‡πÄ‡∏ó‡∏£‡∏î‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏´‡∏°?
    *   **Cooldown**: ‡∏û‡∏∂‡πà‡∏á‡∏à‡∏ö‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡πÑ‡∏°‡πà‡∏ô‡∏≤‡∏ô‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?
4.  **Position Sizing**: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç (Qty) ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏î‡πâ‡∏ß‡∏¢ **ATR-based Risk** (‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô `risk.py`)
5.  **Execution**: ‡∏™‡πà‡∏á Market Order ‡∏ú‡πà‡∏≤‡∏ô `OrderMonitor` (OMS) ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏£‡∏±‡∏ö Update ‡∏à‡∏≤‡∏Å User Stream

---

## üõ†Ô∏è 3. ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (Where to Edit "Stages")

‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏∞‡∏ö‡∏ö ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏ï‡∏≤‡∏°‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:

### üü¢ ‡∏Å. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ó‡∏£‡∏î (Entry Logic / Signals)
*   **‡πÑ‡∏ü‡∏•‡πå**: `live_engine/signal_engine.py`
*   **‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô**: `on_volume_bar()` ‡πÅ‡∏•‡∏∞ `_detect_signal()`
*   **‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ**: ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç EMA Crossover, BB Breakout, ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° Indicator ‡πÉ‡∏´‡∏°‡πà‡πÜ

### üü° ‡∏Ç. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î (System Stage / Constraints)
*   **‡πÑ‡∏ü‡∏•‡πå**: `live_engine/main.py`
*   **‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç**: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `_on_agg_trade()`
    *   **Cooldown**: ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 166 (‡πÄ‡∏ä‡πá‡∏Ñ `self._last_trade_ts`)
    *   **Circuit Breaker**: ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 160 (‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏î‡∏ô‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà)
    *   **Execution TODO**: ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 207 (‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ REST API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏£‡∏¥‡∏á)

### üî¥ ‡∏Ñ. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Order (Order States)
*   **‡πÑ‡∏ü‡∏•‡πå**: `live_engine/oms.py`
*   **Class**: `OrderState` ‡πÅ‡∏•‡∏∞ `OrderMonitor`
*   **‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Stages)**: `PENDING_SUBMIT` -> `NEW` -> `FILLED`
*   **‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ**: ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î Rejection ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Retry ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

### üõ°Ô∏è ‡∏á. ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (Risk & Stage Gate)
*   **‡πÑ‡∏ü‡∏•‡πå**: `live_engine/risk.py`
*   **Class**: `CircuitBreaker`
*   **‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ**: Max Daily Loss, Max Drawdown, Max Consecutive Losses (‡∏ñ‡πâ‡∏≤‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏ó‡∏£‡∏î "Halted")

---

## üìù ‡∏™‡∏£‡∏∏‡∏õ: ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÅ‡∏Å‡πâ "Stage" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏£‡∏î
1.  **‡∏ñ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á Logics ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡∏£‡∏î**: ‡πÅ‡∏Å‡πâ `signal_engine.py`
2.  **‡∏ñ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á Order (Pre-trade check)**: ‡πÅ‡∏Å‡πâ `main.py` ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `_on_agg_trade()`
3.  **‡∏ñ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡∏∑‡∏≠ (In-position management)**: ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö Market Exit (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Logic ‡πÅ‡∏¢‡∏Å‡πÑ‡∏°‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÉ‡∏ô OMS ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô `oms.py`)

> [!TIP]
> **Current Missing Piece**: ‡πÉ‡∏ô `main.py` ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 207 ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡∏™‡∏≤‡∏¢‡∏™‡πà‡∏á Order ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Binance REST API (‡∏°‡∏µ‡πÅ‡∏Ñ‡πà‡∏Å‡∏≤‡∏£ Log ‡πÅ‡∏•‡∏∞ Update OMS) ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° `BinanceRestClient` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á `POST /fapi/v1/order` ‡∏Ñ‡∏£‡∏±‡∏ö
